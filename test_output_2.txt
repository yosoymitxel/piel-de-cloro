
> piel-de-cloro@0.0.0 test
> node --experimental-vm-modules node_modules/jest/bin/jest.js --runInBand --forceExit __tests__/generator_core.test.js __tests__/energy_and_guards.test.js __tests__/advanced_mechanics.test.js

(node:1775893) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL __tests__/generator_core.test.js
  ● Generator Core Overhaul Tests › calculateTotalLoad includes blood test spikes

    expect(received).toBe(expected) // Object.is equality

    Expected: 65
    Received: 60

      62 |
      63 |         // 10 (base) + 10 (mode) + 45 (spike) = 65
    > 64 |         expect(total).toBe(65);
         |                       ^
      65 |     });
      66 |
      67 |     test('calculateTotalLoad handles high paranoia stress', () => {

      at Object.toBe (__tests__/generator_core.test.js:64:23)

  ● Generator Core Overhaul Tests › calculateTotalLoad handles high paranoia stress

    expect(received).toBe(expected) // Object.is equality

    Expected: 25
    Received: 20

      78 |
      79 |         // 10 (base) + 10 (mode) + 5 (paranoia) = 25
    > 80 |         expect(total).toBe(25);
         |                       ^
      81 |     });
      82 |
      83 |     test('updateGenerator decreases stability on overload', () => {

      at Object.toBe (__tests__/generator_core.test.js:80:23)

FAIL __tests__/energy_and_guards.test.js
  ● Energy, Battery & Guard System › Should calculate total load including systems and base consumption

    expect(received).toBe(expected) // Object.is equality

    Expected: 30
    Received: 25

      76 |         // Base 5 + Mode 10 + Sys1 10 + Sys3 5 = 30
      77 |         const load = mechanics.calculateTotalLoad();
    > 78 |         expect(load).toBe(30);
         |                      ^
      79 |     });
      80 |
      81 |     test('Should drain battery based on load when updating generator', () => {

      at Object.toBe (__tests__/energy_and_guards.test.js:78:22)

FAIL __tests__/advanced_mechanics.test.js
  ● Test suite failed to run

    RangeError: Maximum call stack size exceeded

      158 |             State.securityItems = [{ type: 'puerta', secured: true }];
      159 |             let count = 0;
    > 160 |             let spyRandom = jest.spyOn(Math, 'random').mockImplementation(() => {
          |                                                                           ^
      161 |                 count++;
      162 |                 if (count === 1) return 0.1; // trigger
      163 |                 return 0.0; // target

      at Math.<anonymous> (__tests__/advanced_mechanics.test.js:160:75)
      at Math.apply (jest.setup.js:8:67)
      at randomIntInRange (node_modules/source-map/lib/quick-sort.js:43:33)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:75:22)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)
      at doQuickSort (node_modules/source-map/lib/quick-sort.js:100:5)

Test Suites: 3 failed, 3 total
Tests:       3 failed, 13 passed, 16 total
Snapshots:   0 total
Time:        0.707 s, estimated 1 s
Ran all test suites matching /__tests__\/generator_core.test.js|__tests__\/energy_and_guards.test.js|__tests__\/advanced_mechanics.test.js/i.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
